<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DriveSafe Research Demo</title>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      10%, 30%, 50%, 70%, 90% { transform: translateX(-10px); }
      20%, 40%, 60%, 80% { transform: translateX(10px); }
    }
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    @keyframes gradient {
      0%, 100% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
    }
    .animate-shake {
      animation: shake 0.5s ease-in-out;
    }
    .animate-fadeIn {
      animation: fadeIn 0.3s ease-in;
    }
    .gradient-bg {
      background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #334155 100%);
      background-size: 200% 200%;
      animation: gradient 15s ease infinite;
    }
    .glass-effect {
      background: rgba(30, 41, 59, 0.7);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    .card-glow {
      box-shadow: 0 4px 20px rgba(34, 197, 94, 0.2), 0 0 0 1px rgba(34, 197, 94, 0.1);
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    function ControlToggle({ viewMode, setViewMode }) {
      return (
        <div className="w-full max-w-md mb-6">
          <label className="block text-slate-200 text-sm font-bold mb-3 text-center">
            Research Mode
          </label>
          <select
            value={viewMode}
            onChange={(e) => setViewMode(e.target.value)}
            className="w-full glass-effect text-slate-100 border-2 border-slate-600 rounded-xl px-4 py-3 font-semibold focus:outline-none focus:ring-2 focus:ring-green-400 focus:border-green-400 transition-all shadow-lg hover:border-green-500"
          >
            <option value="control">Control: Monitoring Active Only</option>
            <option value="nudge">Nudge Only: Status + Simulation Button</option>
            <option value="full">Full Gamification: Complete UI</option>
          </select>
        </div>
      );
    }

    function PhoneFrame({ children, showAlert, onScreenClick, isDriving }) {
      return (
        <div className={`relative bg-gradient-to-br from-slate-800 via-slate-700 to-slate-800 rounded-[2.5rem] p-2 shadow-2xl transition-transform duration-300 ${showAlert ? 'animate-shake' : ''}`} style={{ boxShadow: '0 20px 60px rgba(0, 0, 0, 0.5), 0 0 0 2px rgba(34, 197, 94, 0.1)' }}>
          <div className="absolute top-0 left-1/2 transform -translate-x-1/2 w-32 h-6 bg-gradient-to-b from-slate-900 to-slate-800 rounded-b-2xl z-10"></div>
          <div 
            className={`bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 rounded-[2rem] overflow-hidden relative ${isDriving ? 'cursor-pointer' : ''}`}
            style={{ width: '375px', height: '812px' }}
            onClick={onScreenClick}
          >
            {children}
            {isDriving && (
              <div className="absolute top-3 right-3 bg-gradient-to-r from-green-500 to-emerald-500 text-white text-xs px-3 py-1.5 rounded-full font-bold z-20 animate-pulse shadow-lg" style={{ boxShadow: '0 0 20px rgba(34, 197, 94, 0.5)' }}>
                🚗 DRIVING - Click Screen
              </div>
            )}
          </div>
        </div>
      );
    }

    function ControlView() {
      return (
        <div className="h-full bg-slate-900 flex items-center justify-center">
          <div className="text-center px-8">
            <div className="inline-flex items-center justify-center w-20 h-20 rounded-full bg-green-500/20 mb-4">
              <div className="w-12 h-12 rounded-full bg-green-500 animate-pulse"></div>
            </div>
            <h2 className="text-2xl font-bold text-slate-200 mb-2">Monitoring Active</h2>
            <p className="text-slate-400 text-sm">DriveSafe is tracking your driving behavior</p>
          </div>
        </div>
      );
    }

    function NudgeOnlyView({ onStartDriving, isDriving, onStopDriving }) {
      return (
        <div className="h-full bg-slate-900 flex flex-col items-center justify-center px-6">
          <div className="text-center mb-8">
            <div className="inline-flex items-center justify-center w-20 h-20 rounded-full bg-green-500/20 mb-4">
              <div className="w-12 h-12 rounded-full bg-green-500 animate-pulse"></div>
            </div>
            <h2 className="text-2xl font-bold text-slate-200 mb-2">Monitoring Active</h2>
            <p className="text-slate-400 text-sm">DriveSafe is tracking your driving behavior</p>
          </div>
          <StartDrivingButton 
            onStartDriving={onStartDriving} 
            isDriving={isDriving}
            onStopDriving={onStopDriving}
          />
        </div>
      );
    }

    function Header() {
      return (
        <div className="flex items-center justify-between px-6 py-5 glass-effect border-b border-slate-700/50">
          <h1 className="text-3xl font-extrabold bg-gradient-to-r from-green-400 to-emerald-400 bg-clip-text text-transparent">
            DriveSafe
          </h1>
          <div className="w-12 h-12 rounded-full bg-gradient-to-br from-slate-700 to-slate-600 flex items-center justify-center shadow-lg border-2 border-slate-500">
            <svg className="w-6 h-6 text-slate-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
            </svg>
          </div>
        </div>
      );
    }

    function SafetyScoreCard() {
      const score = 92;
      const maxScore = 100;
      const percentage = (score / maxScore) * 100;
      const circumference = 2 * Math.PI * 70;
      const offset = circumference - (percentage / 100) * circumference;

      return (
        <div className="glass-effect rounded-3xl p-6 flex flex-col items-center card-glow">
          <h2 className="text-lg font-bold text-slate-200 mb-5">Weekly Safety Score</h2>
          <div className="relative w-44 h-44">
            <svg className="transform -rotate-90" width="176" height="176">
              <circle
                cx="88"
                cy="88"
                r="75"
                stroke="currentColor"
                strokeWidth="10"
                fill="none"
                className="text-slate-700/50"
              />
              <circle
                cx="88"
                cy="88"
                r="75"
                stroke="url(#gradient)"
                strokeWidth="10"
                fill="none"
                strokeDasharray={circumference}
                strokeDashoffset={offset}
                strokeLinecap="round"
                className="transition-all duration-500"
                style={{ filter: 'drop-shadow(0 0 8px rgba(34, 197, 94, 0.5))' }}
              />
              <defs>
                <linearGradient id="gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                  <stop offset="0%" stopColor="#22c55e" />
                  <stop offset="100%" stopColor="#10b981" />
                </linearGradient>
              </defs>
            </svg>
            <div className="absolute inset-0 flex flex-col items-center justify-center">
              <span className="text-5xl font-extrabold bg-gradient-to-r from-green-400 to-emerald-400 bg-clip-text text-transparent">{score}</span>
              <span className="text-xl text-slate-400 font-semibold">/ {maxScore}</span>
            </div>
          </div>
        </div>
      );
    }

    function StatsRow() {
      return (
        <div className="grid grid-cols-2 gap-4">
          <div className="glass-effect rounded-2xl p-5 card-glow border border-slate-700/50">
            <div className="text-slate-400 text-xs mb-2 font-semibold uppercase tracking-wide">Hours Driven</div>
            <div className="text-3xl font-extrabold text-slate-100">12.5</div>
          </div>
          <div className="glass-effect rounded-2xl p-5 card-glow border border-green-500/30">
            <div className="text-slate-400 text-xs mb-2 font-semibold uppercase tracking-wide">Active Streaks</div>
            <div className="text-3xl font-extrabold bg-gradient-to-r from-green-400 to-emerald-400 bg-clip-text text-transparent">7 days</div>
          </div>
        </div>
      );
    }

    function GamificationSection() {
      const badges = [
        { name: 'No-Text Streak', icon: '📱', earned: true },
        { name: 'Safe Commuter', icon: '🚗', earned: true },
        { name: 'Focus Master', icon: '🎯', earned: false }
      ];

      return (
        <div className="glass-effect rounded-3xl p-6 card-glow border border-slate-700/50">
          <h2 className="text-lg font-extrabold text-slate-200 mb-5 flex items-center gap-2">
            <span>🏆</span>
            <span>Badges</span>
          </h2>
          <div className="grid grid-cols-3 gap-3" style={{ alignItems: 'stretch' }}>
            {badges.map((badge, index) => (
              <div
                key={index}
                className={`rounded-2xl transition-all relative ${
                  badge.earned 
                    ? 'bg-gradient-to-br from-green-500/20 to-emerald-500/20 border-2 border-green-400/50 shadow-lg' 
                    : 'bg-slate-700/30 border-2 border-slate-600/50'
                }`}
                style={{
                  height: '140px',
                  padding: '16px',
                  ...(badge.earned ? { boxShadow: '0 4px 15px rgba(34, 197, 94, 0.3)' } : {})
                }}
              >
                <div 
                  className={`text-5xl transition-all ${badge.earned ? 'scale-110' : 'grayscale opacity-40'}`}
                  style={{ 
                    position: 'absolute',
                    top: '16px',
                    left: '50%',
                    transform: `translateX(-50%) ${badge.earned ? 'scale(1.1)' : 'scale(1)'}`,
                    width: '100%',
                    height: '64px',
                    display: 'flex',
                    alignItems: 'center',
                    justifyContent: 'center',
                    margin: 0
                  }}
                >
                  {badge.icon}
                </div>
                <div 
                  className={`text-xs font-bold text-center ${badge.earned ? 'text-green-300' : 'text-slate-500'}`}
                  style={{ 
                    position: 'absolute',
                    bottom: '16px',
                    left: '50%',
                    transform: 'translateX(-50%)',
                    width: '100%',
                    height: '36px',
                    display: 'flex',
                    flexDirection: 'column',
                    justifyContent: 'center',
                    alignItems: 'center',
                    lineHeight: '18px',
                    margin: 0
                  }}
                >
                  <div style={{ height: '18px', lineHeight: '18px' }}>{badge.name.split(' ')[0]}</div>
                  <div style={{ height: '18px', lineHeight: '18px' }}>{badge.name.split(' ')[1]}</div>
                </div>
              </div>
            ))}
          </div>
        </div>
      );
    }

    function LeaderboardPreview() {
      const topUsers = [
        { rank: 1, name: 'Alex M.', score: 98 },
        { rank: 2, name: 'Sarah K.', score: 96 },
        { rank: 3, name: 'Mike T.', score: 95 }
      ];

      return (
        <div className="glass-effect rounded-3xl p-6 card-glow border border-slate-700/50">
          <div className="flex items-center justify-between mb-5">
            <h2 className="text-lg font-extrabold text-slate-200">🏅 Leaderboard</h2>
            <div className="text-sm font-extrabold bg-gradient-to-r from-green-400 to-emerald-400 bg-clip-text text-transparent px-3 py-1 rounded-full glass-effect border border-green-500/30">
              Rank #5
            </div>
          </div>
          <div className="space-y-2">
            {topUsers.map((user) => (
              <div key={user.rank} className="flex items-center justify-between glass-effect rounded-xl p-3 border border-slate-700/50 hover:border-green-500/30 transition-all">
                <div className="flex items-center gap-3">
                  <div className={`w-9 h-9 rounded-full flex items-center justify-center text-xs font-extrabold ${
                    user.rank === 1 ? 'bg-gradient-to-br from-yellow-400 to-orange-400 text-slate-900' :
                    user.rank === 2 ? 'bg-gradient-to-br from-slate-400 to-slate-500 text-white' :
                    'bg-gradient-to-br from-amber-600 to-amber-700 text-white'
                  } shadow-lg`}>
                    #{user.rank}
                  </div>
                  <span className="text-slate-200 font-bold">{user.name}</span>
                </div>
                <span className="text-green-400 font-extrabold text-lg">{user.score}</span>
              </div>
            ))}
          </div>
        </div>
      );
    }

    function StartDrivingButton({ onStartDriving, isDriving, onStopDriving }) {
      if (isDriving) {
        return (
          <button
            onClick={(e) => {
              e.stopPropagation(); // Prevent triggering screen click
              onStopDriving();
            }}
            className="w-full bg-gradient-to-r from-red-600 to-rose-600 hover:from-red-700 hover:to-rose-700 text-white font-extrabold py-5 px-6 rounded-2xl text-lg transition-all shadow-2xl active:scale-95 transform hover:scale-105"
            style={{ boxShadow: '0 10px 30px rgba(220, 38, 38, 0.4)' }}
          >
            🛑 STOP DRIVING
          </button>
        );
      }
      return (
        <button
          onClick={(e) => {
            e.stopPropagation(); // Prevent triggering screen click
            onStartDriving();
          }}
          className="w-full bg-gradient-to-r from-green-500 to-emerald-500 hover:from-green-600 hover:to-emerald-600 text-white font-extrabold py-5 px-6 rounded-2xl text-lg transition-all shadow-2xl active:scale-95 transform hover:scale-105"
          style={{ boxShadow: '0 10px 30px rgba(34, 197, 94, 0.4)' }}
        >
          🚗 START DRIVING
        </button>
      );
    }

    function FullGamificationView({ onStartDriving, isDriving, onStopDriving }) {
      return (
        <div className="h-full bg-slate-900 flex flex-col overflow-y-auto">
          <Header />
          <div className="flex-1 px-6 py-4 space-y-6">
            <SafetyScoreCard />
            <StatsRow />
            <GamificationSection />
            <LeaderboardPreview />
            <StartDrivingButton 
              onStartDriving={onStartDriving} 
              isDriving={isDriving}
              onStopDriving={onStopDriving}
            />
          </div>
        </div>
      );
    }

    function AlertOverlay() {
      return (
        <div className="fixed inset-0 bg-red-600/90 flex items-center justify-center z-50 animate-fadeIn">
          <div className="text-center px-8">
            <div className="text-6xl mb-4 animate-bounce">⚠️</div>
            <h2 className="text-4xl font-bold text-white mb-2">PHONE USE DETECTED!</h2>
            <p className="text-2xl text-white/90 font-semibold">Focus on the road.</p>
          </div>
        </div>
      );
    }

    function App() {
      const [viewMode, setViewMode] = useState('full');
      const [showAlert, setShowAlert] = useState(false);
      const [isDriving, setIsDriving] = useState(false);
      const [phoneShake, setPhoneShake] = useState(false);
      const [startTime, setStartTime] = useState(null);
      const [tripDurationSeconds, setTripDurationSeconds] = useState(0);
      const [sessionData, setSessionData] = useState({
        tripDuration: 0,
        nudgeActivations: 0,
        forbiddenAppTime: 0
      });
      const [savedSessionData, setSavedSessionData] = useState({
        tripDurationSeconds: 0,
        nudgeActivations: 0,
        forbiddenAppTime: 0
      });

      // Timer effect to update trip duration while driving
      useEffect(() => {
        let interval = null;
        if (isDriving && startTime) {
          interval = setInterval(() => {
            const elapsed = Math.floor((Date.now() - startTime) / 1000);
            setTripDurationSeconds(elapsed);
            const minutes = Math.floor(elapsed / 60);
            setSessionData(prev => ({
              ...prev,
              tripDuration: minutes
            }));
          }, 1000);
        } else {
          if (interval) clearInterval(interval);
        }
        return () => {
          if (interval) clearInterval(interval);
        };
      }, [isDriving, startTime]);

      const triggerVibration = () => {
        // Play beep sound
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        const oscillator = audioContext.createOscillator();
        const gainNode = audioContext.createGain();
        
        oscillator.connect(gainNode);
        gainNode.connect(audioContext.destination);
        
        oscillator.frequency.value = 800;
        oscillator.type = 'sine';
        
        gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
        
        oscillator.start(audioContext.currentTime);
        oscillator.stop(audioContext.currentTime + 0.3);

        // Trigger phone shake
        setPhoneShake(true);
        setTimeout(() => {
          setPhoneShake(false);
        }, 500);

        // Show alert
        setShowAlert(true);
        
        // Update session data
        setSessionData(prev => ({
          ...prev,
          nudgeActivations: prev.nudgeActivations + 1
        }));

        // Hide alert after 3 seconds
        setTimeout(() => {
          setShowAlert(false);
        }, 3000);
      };

      const handlePhoneUse = () => {
        triggerVibration();
      };

      const handleScreenClick = () => {
        if (isDriving) {
          triggerVibration();
        }
      };

      const startDriving = () => {
        const now = Date.now();
        setStartTime(now);
        setIsDriving(true);
        setTripDurationSeconds(0);
        // Reset session data when starting a new drive
        setSessionData({
          tripDuration: 0,
          nudgeActivations: 0,
          forbiddenAppTime: 0
        });
      };

      const stopDriving = () => {
        setIsDriving(false);
        // Save the current session data before stopping (save total seconds)
        setSavedSessionData({
          tripDurationSeconds: tripDurationSeconds,
          nudgeActivations: sessionData.nudgeActivations,
          forbiddenAppTime: sessionData.forbiddenAppTime
        });
      };

      const renderView = () => {
        switch (viewMode) {
          case 'control':
            return <ControlView />;
          case 'nudge':
            return <NudgeOnlyView 
              onStartDriving={startDriving} 
              isDriving={isDriving}
              onStopDriving={stopDriving}
            />;
          case 'full':
            return <FullGamificationView 
              onStartDriving={startDriving} 
              isDriving={isDriving}
              onStopDriving={stopDriving}
            />;
          default:
            return <FullGamificationView 
              onStartDriving={startDriving} 
              isDriving={isDriving}
              onStopDriving={stopDriving}
            />;
        }
      };

      return (
        <div className="min-h-screen gradient-bg flex flex-col items-center py-8 px-4">
          <ControlToggle viewMode={viewMode} setViewMode={setViewMode} />
          
          <div className="mt-8">
            <PhoneFrame 
              showAlert={phoneShake} 
              onScreenClick={handleScreenClick}
              isDriving={isDriving}
            >
              {renderView()}
            </PhoneFrame>
          </div>

          {showAlert && <AlertOverlay />}

          <div className="mt-6 w-full max-w-sm">
            <div className="glass-effect rounded-2xl p-5 text-slate-300 card-glow border border-slate-700/50">
              <h3 className="text-base font-extrabold mb-4 text-slate-100 uppercase tracking-wide flex items-center gap-2">
                <span className="w-2 h-2 bg-green-400 rounded-full animate-pulse"></span>
                Session Log
              </h3>
              <div className="space-y-3 text-sm">
                <div className="flex justify-between items-center glass-effect rounded-lg p-3 border border-slate-700/50">
                  <span className="text-slate-300 font-semibold">Trip Duration:</span>
                  <span className="font-extrabold text-lg text-green-400">
                    {isDriving 
                      ? `${String(Math.floor(tripDurationSeconds / 60)).padStart(2, '0')}:${String(tripDurationSeconds % 60).padStart(2, '0')}`
                      : savedSessionData.tripDurationSeconds > 0 
                        ? `${String(Math.floor(savedSessionData.tripDurationSeconds / 60)).padStart(2, '0')}:${String(savedSessionData.tripDurationSeconds % 60).padStart(2, '0')}`
                        : '00:00'
                    }
                  </span>
                </div>
                <div className="flex justify-between items-center glass-effect rounded-lg p-3 border border-slate-700/50">
                  <span className="text-slate-300 font-semibold">Nudge Activations:</span>
                  <span className="font-extrabold text-lg text-yellow-400">
                    {isDriving ? sessionData.nudgeActivations : savedSessionData.nudgeActivations}
                  </span>
                </div>
                <div className="flex justify-between items-center glass-effect rounded-lg p-3 border border-slate-700/50">
                  <span className="text-slate-300 font-semibold">Forbidden App Time:</span>
                  <span className="font-extrabold text-lg text-red-400">
                    {isDriving ? sessionData.forbiddenAppTime : savedSessionData.forbiddenAppTime}s
                  </span>
                </div>
              </div>
            </div>
          </div>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>
